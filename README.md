# 控制器演示项目文档

## 项目概述

这是一个基于WPF的控制器演示项目，主要用于实时显示和监控多通道数据。项目使用了LightningChart控件来实现高性能的数据可视化，并集成了TCP/UDP通信功能用于数据采集。

## 开发环境

- 开发框架：WPF
- 开发语言：C#
- 图表控件：LightningChart
- 开发工具：Visual Studio
- 目标平台：Windows

## 主要功能

### 1. 图表显示功能

- 支持多图表显示，可动态添加新图表
- 每个图表支持8个通道的数据显示
- 实时数据更新和曲线绘制
- 支持图表缩放和重置
- 提供光标跟踪功能，显示数据点具体值
- 支持图例显示/隐藏切换

### 2. 数据采集功能

- TCP客户端数据接收
- UDP设备发现和连接
- 支持多通道数据同步采集
- 数据缓存和处理机制
- 实时数据更新

### 3. 用户交互功能

- 图例显示/隐藏切换
- 支持文件拖拽导入数据
- 双击删除曲线
- 右键菜单操作
- 图表关闭功能
- 图表缩放重置

### 4. 数据管理功能

- 数据文件保存
- 文件夹管理
- 文件删除功能
- 历史数据查看

## 项目结构

### 主要类

1. **ControllerViewModel**
   - 核心视图模型类
   - 实现数据处理和UI逻辑
   - 管理图表和设备列表

2. **DeviceInfoModel**
   - 设备信息模型
   - 存储设备连接信息

3. **GlobalValues**
   - 全局变量管理
   - TCP/UDP客户端实例

### 关键组件

1. **图表组件**

   ```csharp
   public List<LightningChart> Charts { get; set; }
   ```

2. **数据缓冲区**

   ```csharp
   private readonly ConcurrentDictionary<int, List<float>> _dataBuffer
   ```

3. **设备列表**

   ```csharp
   public ObservableCollection<DeviceInfoModel> Devices
   ```

## 使用说明

### 1. 安装和配置

1. 确保系统已安装.NET Framework
2. 安装必要的依赖包
3. 配置数据存储路径（默认：D:\Datas）

### 2. 基本操作流程

1. 启动程序
2. 查询设备列表
3. 连接目标设备
4. 点击开始按钮开始采集数据
5. 根据需要添加或关闭图表

### 3. 图表操作

- 点击"添加图表"按钮新增图表
- 拖拽调整图表位置
- 双击曲线删除对应通道
- 使用右键菜单进行操作
- 点击"重置缩放"恢复默认视图

### 4. 数据管理

- 数据自动保存至指定文件夹
- 通过文件列表查看历史数据
- 支持文件拖拽导入显示
- 可删除不需要的数据文件

## 性能优化

### 1. 数据处理优化

- 使用ConcurrentDictionary实现线程安全
- 批量数据处理减少UI更新频率
- Interlocked原子操作保证数据一致性

### 2. UI更新优化

- BeginUpdate/EndUpdate批量更新
- Dispatcher.Invoke确保UI线程同步
- 图表数据批处理更新

## 配置参数

### 基本配置

- 数据存储路径：D:\Datas
- 数据点数：1024/通道
- 通道数量：8
- 更新间隔：50ms

### 图表配置

- X轴范围：0-1024
- Y轴范围：-5到10
- 支持自动缩放

## 注意事项

1. 运行前检查
   - 确保数据存储路径可访问
   - 检查网络连接状态
   - 验证设备是否在线

2. 运行时注意
   - 监控内存占用
   - 注意数据处理延迟
   - 定期清理历史数据

3. 异常处理
   - 网络断开自动重连
   - 数据异常自动恢复
   - 资源自动释放

## 常见问题解决

### 1. 图表不显示数据

- 检查设备连接状态
- 验证数据采集是否正常
- 确认通道配置正确

### 2. 性能问题

- 减少同时显示的图表数量
- 适当增加更新间隔
- 清理历史数据释放内存

### 3. 连接问题

- 检查网络设置
- 验证设备IP地址
- 确认防火墙设置

## 未来扩展

1. 数据分析功能
   - 数据统计分析
   - 趋势预测
   - 异常检测

2. 用户界面优化
   - 自定义主题
   - 多语言支持
   - 界面布局保存

3. 功能增强
   - 数据导出功能
   - 报表生成
   - 远程控制
